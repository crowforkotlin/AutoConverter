[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
# [WIP] AutoConverter

AutoConverter is a simple tool to convert data classes to JSONObject. 
It can be used in **Android log entity conversion**, or in any other use case where you need to convert a data class to a JSONObject.

I planned two versions, one is the **ksp** version, and the other is **kcp and IDE plugin** version.


- [x] nested classes
- [x] naming strategy for properties, e.g. camel to underline
- [x] code style config, e.g. indent
- [x] fields marked nullable
- [ ] conversion between JSONArray and List
- [ ] conversion between JSONObject and Map
- [ ] deserialization: fromJSONObject
- [ ] publish to maven central

## KSP
 
### Usage

- The `AutoConvert` annotation is defined as following:
```kotlin
package com.mato.stg4.annotation

/**
 * Auto convert annotation

 * @property functions enabled auto convert functions, toJSONObject by default
 * @property namingStrategy naming strategy, None by default
 * @property filePostfix file postfix, Ext by default, filename is ClassName + filePostfix
 * @constructor Create empty Auto convert
 */
@MustBeDocumented
@Target(AnnotationTarget.CLASS)
@Retention(AnnotationRetention.BINARY)
annotation class AutoConvert(
    val functions: Array<ACFunction> = [ACFunction.ToJSONObject],
    val namingStrategy: NamingStrategy = NamingStrategy.None,
    val filePostfix: String = "Ext"
)
```

- Add `AutoConvert` to your classes
```kotlin
// Restaurant.kt, its a outer class
package com.mato.stg4cpp

import com.mato.stg4.annotation.AutoConvert
import com.mato.stg4cpp.pkg2.Gender
import com.mato.stg4cpp.pkg2.Location

@AutoConvert
data class Restaurant(
    val score: Float = 0.0f,
    val comments: Int = 0,
    val boss: Boss,
    val location: Location? = null,
    val foods: List<String> = emptyList(),
    val gender: Gender = Gender()
)


@AutoConvert // it's a nested class with the same package name 
data class Boss(
    val gender: Int,
    val age: Int,
    val name: String
)
```
```kotlin
// Gender.kt, it's a nested class, too. And it has different package name with the outer.
package com.mato.stg4cpp.pkg2

import com.mato.stg4.annotation.AutoConvert
import kotlin.random.Random

@AutoConvert
data class Gender(
    val value: Int = Random.nextInt(),
    val desc: String = "gender"
)
```

- The generate files:
```kotlin
// Generated by AutoConvert. Do not edit!
package com.mato.stg4cpp

import kotlin.Result
import org.json.JSONObject

public fun Boss.toJSONObject(): Result<JSONObject> = kotlin.runCatching {
    JSONObject().also {
        it.put("gender", this.gender)
        it.put("age", this.age)
        it.put("name", this.name)
    }
}
```

```kotlin
// Generated by AutoConvert. Do not edit!
package com.mato.stg4cpp.pkg2

import kotlin.Result
import org.json.JSONObject

public fun Gender.toJSONObject(): Result<JSONObject> = kotlin.runCatching {
    JSONObject().also {
        it.put("value", this.value)
        it.put("desc", this.desc)
    }
}
```

```kotlin
// Generated by AutoConvert. Do not edit!
package com.mato.stg4cpp

import com.mato.stg4cpp.pkg2.toJSONObject
import com.mato.stg4cpp.toJSONObject
import kotlin.Result
import org.json.JSONObject

public fun Restaurant.toJSONObject(): Result<JSONObject> = kotlin.runCatching {
    JSONObject().also {
        it.put("score", this.score)
        it.put("comments", this.comments)
        it.put("boss", this.boss.toJSONObject().getOrThrow())
        it.put("location", this.location?.toJSONObject()?.getOrThrow())
        it.put("foods", this.foods)
        it.put("gender", this.gender.toJSONObject().getOrThrow())
    }
}

```

## KCP